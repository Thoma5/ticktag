<div class="col-md-12 form-box">
  <div *ngIf="loading">
    <tt-loading></tt-loading>
  </div>
  <div *ngIf="!loading">
    <div class="search row">
      <div class="col-md-12">
        <tt-ticket-filter [allTicketTags]="allTicketTags" [allUsers]="allProjectUsers" (ticketFilter)="updateFilter($event)">
        </tt-ticket-filter>
      </div>
    </div>
    <swui-datatable class="material" [rows]="rows" [columns]="columns" [columnMode]="'force'" [headerHeight]="32" [rowHeight]="32"
      [footerHeight]="32" [externalPaging]="true" [count]="totalElements" [offset]="offset" [limit]="limit" [scrollbarH]="true"
      [scrollbarV]="false" [loadingIndicator]="reloading" [externalSorting]="true" (sort)="onSort($event)" (page)='onPage($event)'
      [cssClasses]="iconsCss" [selectionType]="'row'" (activate)="activate($event)">
      <swui-datatable-column name="#" prop="number" width="48" maxWidth="48" resizeable="false">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          <s *ngIf="!row.open" style="color: grey;">#{{value}}</s>
          <p *ngIf="row.open">#{{value}}</p>
        </template>
      </swui-datatable-column>
      <swui-datatable-column name="Title" minWidth="128" width="256">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          <a routerLink="/project/{{projectId}}/ticket/{{row.number}}">
            <s style="color: grey;" *ngIf="!row.open">{{value}}</s>
            <p *ngIf="row.open">{{value}}</p>
          </a>
        </template>
      </swui-datatable-column>
      <swui-datatable-column name="Tags" minWidth="64" width="256" maxWidth="512" sortable="false">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          <tt-tagview [tags]="value" (clickedTag)="onTagClicked($event)"></tt-tagview>
        </template>
      </swui-datatable-column>
      <swui-datatable-column name="Asignees" prop="users" minWidth="128" width="128" maxWidth="128">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          <div float="left">
            <tt-assigned-user-overview [users]="value"></tt-assigned-user-overview>
          </div>
        </template>
      </swui-datatable-column>
      <swui-datatable-column name="SP" prop="storyPoints" minWidth="96" width="96" maxWidth="96" resizeable="false">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          {{value}}
        </template>
      </swui-datatable-column>
      <swui-datatable-column name="Due Date" prop="dueDate" minWidth="128" width="128" maxWidth="128" resizeable="false">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          {{value | date: 'yyyy-MM-dd'}}
        </template>
      </swui-datatable-column>
      <swui-datatable-column name="Progress" minWidth="128" width="128" maxWidth="128">
        <template let-row="row" let-value="value" swui-datatable-cell-template>
          <div *ngIf="value !== '' && value <= 1" style="border:solid 0.11em #d3d3d3; margin:0.5em" tooltip="{{value*100 | number : '1.0-0'}}%"
            tooltipPlacement="bottom" tooltipTrigger="mouseenter">
            <div style="background:linear-gradient(to bottom, #00b7ea 0%,#009ec3 100%);height:0.8em" [style.width]="value*100+'%'"></div>
          </div>
          <div *ngIf="value !== '' && value > 1" style="border:solid 0.11em #d3d3d3; margin:0.5em" tooltip="{{value*100 | number : '1.0-0'}}%"
            tooltipPlacement="bottom" tooltipTrigger="mouseenter">
            <div style="background:linear-gradient(to bottom, #ff3019 0%,#cf0404 100%);height:0.8em" [style.width]="100+'%'"></div>
          </div>
          <div *ngIf="value === ''" style="margin-left: 3em" tooltip="No estimation!" tooltipPlacement="bottom" tooltipTrigger="mouseenter">
            -
          </div>
        </template>
      </swui-datatable-column>
    </swui-datatable>
  </div>
</div>
